(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j=[].slice,F={}.hasOwnProperty,I=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};s=function(e){var t,n,r;if(e instanceof Array)t=function(){var t,n,i;i=[];for(t=0,n=e.length;t<n;t++)r=e[t],i.push(r);return i}();else{t={};for(n in e)r=e[n],t[n]=r}return t},String.prototype.trim==null&&(String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}),c=function(e){var t,n,r,i,s;e==null&&(e=function(){}),n=e.toString().match(/function[^(]*\(([^)]*)\)/);if(n==null||n.length<2)return[];n=n[1],n=n.split(/\s*,\s*/),s=[];for(r=0,i=n.length;r<i;r++)t=n[r],t.trim()!==""&&s.push(t);return s},_=function(e){var t;e==null&&(e=8),t="";while(t.length<e)t+=Math.random().toString(36).substr(2);return t.substr(0,e)},T=function(e,t,n){var r,i,s,o,u,a,f,l,c;e==null&&(e=[]),t==null&&(t=function(){}),i=e.length,u=[];if(i===0)return typeof t=="function"?t(null,u):void 0;s=[],r=function(){var e;i--;if(i===0)return function(){var t,n,r;r=[];for(t=0,n=s.length;t<n;t++)e=s[t],e!=null&&r.push(e);return r}().length>0?t(s,u):t(null,u)},c=[];for(o=f=0,l=e.length;f<l;o=++f)a=e[o],c.push(function(e,t){var i;i=function(){var e,n;return e=arguments[0],n=2<=arguments.length?j.call(arguments,1):[],e!=null?(s[t]=e,u[t]=void 0):u[t]=n.length<2?n[0]:n,r()};try{return e(i)}catch(o){if(n)return i(o)}}(a,o));return c},N=function(e,t){var n,r;return n=-1,e.length===0?t():(r=function(){var i,s;return i=arguments[0],s=2<=arguments.length?j.call(arguments,1):[],i!=null?t(i):++n===e.length?t.apply(null,[null].concat(j.call(s))):e[n].apply(e,j.call(s).concat([r]))},r())},f=function(e,t,n){var r,i;return e==null&&(e=[]),i=function(){var n,i,s;s=[];for(n=0,i=e.length;n<i;n++)r=e[n],s.push(function(e){return function(n){return t(e,n)}}(r));return s}(),H.runSeries(i,n)},H={doForAll:f,runSeries:T,runWaterfall:N,clone:s,getArgumentNames:c,uniqueId:_},e=function(){function e(e,t){this.cascadeChannels=t!=null?t:!1,this.channels={},e&&this.installTo(e)}return e.prototype.subscribe=function(t,n,r){var i,s,o,u,a,f,l,c,h,p,d;r==null&&(r=this),(h=(f=this.channels)[t])==null&&(f[t]=[]),u=this;if(t instanceof Array){p=[];for(l=0,c=t.length;l<c;l++)i=t[l],p.push(this.subscribe(i,n,r));return p}if(typeof t=="object"){d=[];for(s in t)a=t[s],d.push(this.subscribe(s,a,n));return d}return typeof n!="function"?!1:typeof t!="string"?!1:(o={context:r,callback:n},{attach:function(){return u.channels[t].push(o),this},detach:function(){return e._rm(u,t,o.callback),this}}.attach())},e.prototype.on=e.prototype.subscribe,e.prototype.unsubscribe=function(t,n){var r;switch(typeof t){case"string":typeof n=="function"&&e._rm(this,t,n),typeof n=="undefined"&&e._rm(this,t);break;case"function":for(r in this.channels)e._rm(this,r,t);break;case"undefined":for(r in this.channels)e._rm(this,r);break;case"object":for(r in this.channels)e._rm(this,r,null,t)}return this},e.prototype.publish=function(e,t,n){var r,i,s,o,u;return n==null&&(n={}),typeof t=="function"&&(n=t,t=void 0),typeof e!="string"?!1:(o=this.channels[e]||[],typeof t=="object"&&n.publishReference!==!0&&(i=H.clone(t)),u=function(){var n,r,u;u=[];for(n=0,r=o.length;n<r;n++)s=o[n],u.push(function(n){return function(r){try{return H.getArgumentNames(n.callback).length>=3?n.callback.apply(n.context,[i||t,e,r]):r(null,n.callback.apply(n.context,[i||t,e]))}catch(s){return r(s)}}}(s));return u}(),H.runSeries(u,function(e,t){var r,i;return e&&(r=new Error(function(){var t,n,r;r=[];for(t=0,n=e.length;t<n;t++)i=e[t],i!=null&&r.push(i.message);return r}().join("; "))),typeof n=="function"?n(r):void 0},!0),this.cascadeChannels&&(r=e.split("/")).length>1&&this.publish(r.slice(0,-1).join("/"),t,n),this)},e.prototype.emit=e.prototype.publish,e.prototype.installTo=function(e){var t,n;if(typeof e=="object")for(t in this)n=this[t],e[t]=n;return this},e._rm=function(e,t,n,r){var i;return e.channels[t]=function(){var s,o,u,a;u=e.channels[t],a=[];for(s=0,o=u.length;s<o;s++)i=u[s],(n!=null?i.callback!==n:r!=null?i.context!==r:i.context!==e)&&a.push(i);return a}()},e}(),t=function(){function e(e,t,n){this.core=e,this.instanceId=t,this.options=n!=null?n:{};if(this.core==null)throw new TypeError("core was not defined");if(t==null)throw new TypeError("no id was specified");if(typeof t!="string")throw new TypeError("id is not a string")}return e}(),(typeof module!=="undefined"&&module!==null?module.exports:void 0)!=null&&(module.exports=t),n="0.3.9",i=function(e,t,n){if(typeof t!==e)throw new TypeError(""+n+" has to be a "+e)},y={},d={},p={},g=new e,E={},l=function(e){return typeof console!="undefined"&&console!==null?typeof console.error=="function"?console.error(e.message):void 0:void 0},w={_always:[]},b=function(e,t){var n;i("function",e,"parameter"),n={context:this,callback:e};if(typeof t=="string")return w[t]==null&&(w[t]=[]),w[t].push(n);if(t==null)return w._always.push(n)},h=function(e,t,n){var r,i,s,o,u;s={},u=t.options;for(i in u)o=u[i],s[i]=o;r=p[e];if(r)for(i in r)o=r[i],s[i]=o;if(n)for(i in n)o=n[i],s[i]=o;return s},a=function(e,n,r){var i,s,u,a,f,l,c,p,v,m,b,S,x,T,N,C,k;n==null&&(n=e),l=y[e];if(d[n]!=null)return d[n];u=h(n,l,r),m=new t(o,n,u),g.installTo(m);for(s in E){p=E[s];if(p.sandbox==null)continue;v=new p.sandbox(m);for(f in v){if(!F.call(v,f))continue;b=v[f],m[f]=b}}a=new l.creator(m),a.options=u,a.id=n,d[n]=a,C=[n,"_always"];for(S=0,T=C.length;S<T;S++){c=C[S];if(w[c]!=null){k=w[c];for(x=0,N=k.length;x<N;x++)i=k[x],i.callback.apply(i.context)}}return a},r=function(e,t,n){var r;i("string",e,"module ID"),i("function",t,"creator"),i("object",n,"option parameter"),r=new t,i("object",r,"the return value of the creator"),i("function",r.init,"'init' of the module"),i("function",r.destroy,"'destroy' of the module ");if(y[e]!=null)throw new TypeError("module "+e+" was already registered");return y[e]={creator:t,options:n,id:e},!0},S=function(e,t,n){n==null&&(n={});try{return r(e,t,n)}catch(i){return l(new Error("could not register module '"+e+"': "+i.message)),!1}},k=function(e,t){var n,r,s,o;i("string",e,"instance ID"),i("object",t,"option parameter"),(s=p[e])==null&&(p[e]={}),o=[];for(n in t)r=t[n],o.push(p[e][n]=r);return o},D=function(e,t){return t[e]!=null?(delete t[e],!0):!1},P=function(e){var t,n;n=[];for(t in e)n.push(D(t,e));return n},L=function(e,t){var n;t==null&&(t={});try{i("string",e,"module ID"),i("object",t,"second parameter");if(y[e]==null)throw new Error("module doesn't exist");n=a(e,t.instanceId,t.options);if(n.running===!0)throw new Error("module was already started");return H.getArgumentNames(n.init).length>=2?n.init(n.options,function(e){return typeof t.callback=="function"?t.callback(e):void 0}):(n.init(n.options),typeof t.callback=="function"&&t.callback(null)),n.running=!0,!0}catch(r){return l(r),typeof t.callback=="function"&&t.callback(new Error("could not start module: "+r.message)),!1}},O=function(e,t){var n;return(n=d[e])?(g.unsubscribe(n),H.getArgumentNames(n.destroy).length>=1?n.destroy(function(e){return typeof t=="function"?t(e):void 0}):(n.destroy(),typeof t=="function"&&t(null)),delete d[e],!0):!1},A=function(e,t){var n,r,i,s,o,u,a;return e instanceof Array?(s=e,e=t,t=null,u=function(){var e,t,r;r=[];for(e=0,t=s.length;e<t;e++)n=s[e],y[n]!=null&&r.push(n);return r}()):s=u=function(){var e;e=[];for(n in y)e.push(n);return e}(),u.length===(a=s.length)&&a===0?(typeof e=="function"&&e(null),!0):(u.length!==s.length&&(r=function(){var e,t,r;r=[];for(e=0,t=s.length;e<t;e++)n=s[e],I.call(u,n)>=0||r.push("'"+n+"'");return r}(),i=new Error("these modules don't exist: "+r)),o=function(e,t){var n,r,i,s;i={},r=y[e].options;for(n in r){if(!F.call(r,n))continue;s=r[n],s&&(i[n]=s)}return i.callback=function(e){return typeof r.callback=="function"&&r.callback(e),t(e)},L(e,i)},H.doForAll(u,o,function(t){var n,r,s;return(t!=null?t.length:void 0)>0&&(n=new Error("errors occoured in the following modules: "+function(){var e,n,i;i=[];for(r=e=0,n=t.length;e<n;r=++e)s=t[r],s!=null&&i.push("'"+u[r]+"'");return i}())),typeof e=="function"?e(n||i):void 0}),i==null)},M=function(e){var t;return H.doForAll(function(){var e;e=[];for(t in d)e.push(t);return e}(),O,e)},C=["core","instanceId","options","publish","emit","on","subscribe","unsubscribe"],m=function(e){var t,n,r;r=[];for(t in e)n=e[t],r.push(t);return r},x=function(e){var n,r,s,a,f;n=new Error("plugin uses reserved keyword");try{i("object",e,"plugin"),i("string",e.id,"'id' of plugin");if(typeof e.sandbox=="function"){for(r in new e.sandbox(new t(o,"")))if(I.call(C,r)>=0)throw n;a=e.sandbox.prototype;for(r in a)s=a[r],t.prototype[r]=s}if(typeof e.core=="object"){for(r in e.core)if(I.call(u,r)>=0)throw n;f=e.core;for(r in f)s=f[r],o[r]=s,typeof exports!="undefined"&&exports!==null&&(exports[r]=s)}return typeof e.onInstantiate=="function"&&b(e.onInstantiate),E[e.id]=e,!0}catch(c){return l(c),!1}},o={VERSION:n,register:S,unregister:function(e){return D(e,y)},unregisterAll:function(){return P(y)},registerPlugin:x,unregisterPlugin:function(e){return D(e,E)},unregisterAllPlugins:function(){return P(E)},setInstanceOptions:k,start:L,stop:O,startAll:A,stopAll:M,uniqueId:H.uniqueId,lsInstances:function(){return m(d)},lsModules:function(){return m(y)},lsPlugins:function(){return m(E)},util:H,Mediator:e,Sandbox:t,subscribe:function(){return g.subscribe.apply(g,arguments)},on:function(){return g.subscribe.apply(g,arguments)},unsubscribe:function(){return g.unsubscribe.apply(g,arguments)},publish:function(){return g.publish.apply(g,arguments)},emit:function(){return g.publish.apply(g,arguments)}},u=function(){var e;e=[];for(v in o)B=o[v],e.push(v);return e}(),(typeof module!=="undefined"&&module!==null?module.exports:void 0)!=null&&(module.exports=o),(typeof define!=="undefined"&&define!==null?define.amd:void 0)!=null?(typeof define!=="undefined"&&define!==null?define.amd:void 0)!=null&&define(function(){return o}):typeof window!="undefined"&&window!==null&&(window.scaleApp=o)}).call(this);